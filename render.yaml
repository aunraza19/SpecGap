# render.yaml - Render Blueprint Specification
# Deploy with: Connect GitHub repo to Render and select this file

services:
  # ============== Backend + Frontend (Single Service) ==============
  - type: web
    name: specgap
    runtime: docker
    dockerfilePath: ./Dockerfile
    region: oregon  # or singapore, frankfurt, ohio
    plan: free  # free, starter, standard, pro

    # Health check
    healthCheckPath: /api/v1/health

    # Environment variables
    envVars:
      # Required: AI API Keys (set in Render dashboard for security)
      - key: GEMINI_API_KEY
        sync: false  # Set manually in dashboard
      - key: GEMINI_API_KEY_ROUND1
        sync: false
      - key: GEMINI_API_KEY_ROUND2
        sync: false
      - key: GEMINI_API_KEY_ROUND3
        sync: false

      # Application settings
      - key: ENV
        value: production
      - key: DEBUG
        value: "false"
      - key: LOG_LEVEL
        value: INFO

      # CORS - Update with your actual Render URL after deployment
      - key: CORS_ORIGINS
        value: "*"

      # Database (SQLite for free tier, consider PostgreSQL for production)
      - key: DATABASE_URL
        value: sqlite:///./specgap_audits.db

      # Queue settings
      - key: QUEUE_ENABLED
        value: "true"
      - key: MAX_CONCURRENT_SESSIONS
        value: "1"
      - key: QUEUE_TIMEOUT
        value: "180"

      # Rate limiting
      - key: AI_RATE_LIMIT_REQUESTS
        value: "15"
      - key: AI_RATE_LIMIT_WINDOW
        value: "60"

# Note: For persistent database, add a PostgreSQL database:
# databases:
#   - name: specgap-db
#     plan: free
#     databaseName: specgap
#     user: specgap

